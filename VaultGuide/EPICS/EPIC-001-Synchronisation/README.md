# EPIC-001: Vault Synchronisation Automation

**Epic Type**: VaultGuide Meta-Epic
**Status**: ðŸ“‹ Planned
**Owner**: Product Operations Team
**Created**: 2025-11-05
**Updated**: 2025-11-12

---

## Purpose

Create a reliable bridge between the code repository and the knowledge vault so that documentation produced during development automatically lands in the vault with consistent metadata, traceability, and immediate visibility to engineers via symlinks.

**Context**: This is a **meta-epic** about the vault system itself, not about the trading platform product. It belongs in VaultGuide because it documents automation for managing the vault infrastructure.

---

## Problem Statement

### Current Pain Points
1. **Manual Documentation Movement**: Claude generates docs in code repo, but they must be manually moved to vault
2. **Inconsistent Metadata**: YAML frontmatter often missing or incomplete
3. **Broken Traceability**: Generated docs don't automatically link to EPICs/Features/Stories
4. **Symlink Management**: Symlinks break when vault structure changes
5. **Duplicate Content**: Engineers sometimes duplicate content instead of using symlinks

### Desired State
- 100% of Claude-generated documentation automatically captured in vault
- All documentation includes proper YAML frontmatter (epic, feature, story, source_repo)
- Bidirectional links automatically established (doc â†’ epic, epic â†’ doc)
- Symlinks automatically validated and repaired
- Zero manual copy/paste needed

---

## Objectives

### Primary Objectives
1. **Detect and Classify**: Identify files generated by Claude or other assistants in code repository
2. **Route with Metadata**: Move approved files into vault with complete YAML frontmatter
3. **Establish Traceability**: Update backlinks to EPICs, Features, Stories automatically
4. **Maintain Symlinks**: Ensure code repo symlinks always reflect vault structure
5. **Automate Workflow**: Integrate into git hooks or make targets for seamless operation

### Success Metrics
- âœ… 100% of Claude-generated implementation docs captured in vault
- âœ… Traceability metadata (`epic`, `feature`, `story`, `source_repo`) populated for all artifacts
- âœ… No manual copy/paste needed to surface docs in code repository
- âœ… Symlink health checks pass automatically
- âœ… < 30 seconds from doc generation to vault integration

---

## Stories

| Story ID | Story Title | Status | Owner |
|----------|-------------|--------|-------|
| [STORY-001](./Stories/STORY-001-DocRouter/README.md) | Doc Router and Symlink Automation | ðŸ“‹ Planned | DevOps |

**Total**: 1 Story

---

## Architecture Overview

### Current Manual Flow
```
Engineer runs Claude Code
    â†“
Claude generates docs in code repo
    â†“
Engineer manually copies to vault
    â†“
Engineer manually adds YAML frontmatter
    â†“
Engineer manually updates EPIC/Feature links
    â†“
Engineer commits to both repos
```

### Target Automated Flow
```
Engineer runs Claude Code
    â†“
Claude generates docs in code repo
    â†“
[claude_doc_router.py] detects new docs
    â†“
Router proposes destination + metadata (using AI)
    â†“
Engineer confirms (or adjusts)
    â†“
Router moves file to vault with YAML
    â†“
Router updates EPIC/Feature/Story backlinks
    â†“
[symlink validator] ensures links healthy
    â†“
Engineer commits vault changes
```

---

## Key Components

### 1. Documentation Router (`scripts/claude_doc_router.py`)
**Purpose**: Detect, classify, and route documentation from code repo to vault

**Capabilities**:
- Scan configured paths for new files (e.g., `documentation/`, `docs/`)
- Apply routing rules from `config/doc_routing.yml`
- Use Claude API to suggest destinations and metadata enrichment
- Present confirmation prompt with preview
- Move files to vault with proper directory structure
- Inject YAML frontmatter if missing
- Update EPIC/Feature/Story indexes with backlinks

**Example Usage**:
```bash
# After Claude Code session
make archive-docs

# Or directly
python scripts/claude_doc_router.py --interactive
```

### 2. Routing Configuration (`config/doc_routing.yml`)
**Purpose**: Define rules for mapping files to vault destinations

**Features**:
- Filename pattern matching (glob patterns)
- Vault destination templates
- YAML frontmatter templates
- Backlink target specifications

**Example**:
```yaml
routing_rules:
  - pattern: "IMPLEMENTATION-*.md"
    destination: "Product/TechnicalDocumentation/"
    metadata_template:
      artifact_type: implementation_summary
      related_epic: [auto-detect]
      related_feature: [auto-detect]
    backlink_targets:
      - epic_readme
      - feature_traceability
```

### 3. Symlink Manager (`scripts/setup_vault_symlinks.sh`)
**Purpose**: Validate and repair symlinks between code repo and vault

**Capabilities**:
- Detect vault location relative to code repo
- Create all required symlinks (vault_epics, vault_design, etc.)
- Validate existing symlinks and report broken ones
- Automatically repair broken symlinks
- Can be invoked from `make bootstrap` or manually

**Example Usage**:
```bash
# Check symlink health
./VaultGuide/setup_vault_symlinks.sh --check

# Repair broken symlinks
./VaultGuide/setup_vault_symlinks.sh --repair
```

### 4. Symlink Health Monitor (`scripts/validate_symlinks.py`)
**Purpose**: Continuous validation of symlink integrity

**Capabilities**:
- Scan all symlinks in code repo
- Report broken symlinks
- Suggest fixes
- Can be integrated into pre-commit hooks or CI/CD

---

## Integration Points

### Git Hooks
```bash
# .git/hooks/pre-commit
# Run symlink validation before commit
scripts/validate_symlinks.py --fail-on-broken

# .git/hooks/post-merge
# Repair symlinks after pulling changes
VaultGuide/setup_vault_symlinks.sh --repair
```

### Makefile Targets
```makefile
archive-docs:
	python scripts/claude_doc_router.py --interactive

check-symlinks:
	scripts/validate_symlinks.py

bootstrap:
	VaultGuide/setup_vault_symlinks.sh
```

---

## Stakeholders

### Primary Stakeholders
- **Product & Documentation Owners**: Curate knowledge vault, ensure quality
- **Engineers**: Generate documentation during development
- **Claude/AI Assistants**: Produce implementation artifacts
- **DevOps**: Maintain automation and developer experience

### Responsibilities (RACI)
| Activity | Product Owner | Engineers | DevOps | Claude/AI |
|----------|---------------|-----------|--------|-----------|
| Generate documentation | I | R | I | R |
| Route documentation | C | R | A | C |
| Maintain routing rules | A | C | R | I |
| Validate symlinks | I | R | A | - |
| Update EPIC backlinks | A | C | R | C |

**Legend**: R = Responsible, A = Accountable, C = Consulted, I = Informed

---

## Dependencies

### Prerequisites
- âœ… Vault structure established (`/Users/nitindhawan/KnowledgeVaults/SynapticTrading_Vault/`)
- âœ… VaultGuide documentation complete
- âœ… UPMS templates defined
- â³ Python environment with required libraries
- â³ Claude API access for AI-powered routing

### Blocks/Risks
| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Broken symlinks after vault restructure | ðŸ”´ High | ðŸŸ¡ Medium | Automated symlink validation + repair |
| Metadata drift | ðŸŸ¡ Medium | ðŸŸ¡ Medium | Router enforces YAML frontmatter |
| Wrong routing decisions | ðŸŸ¡ Medium | ðŸ”´ High | Interactive confirmation step |
| Permission issues (macOS TCC) | ðŸŸ¡ Medium | ðŸŸ¢ Low | Document required permissions |

---

## Implementation Phases

### Phase 1: Basic Router (STORY-001)
- âœ… Manual symlink setup script (already exists)
- â³ Documentation router with interactive confirmation
- â³ YAML frontmatter injection
- â³ Basic routing configuration

### Phase 2: Automated Backlinks
- â³ EPIC/Feature/Story index updates
- â³ Sprint notes integration
- â³ Bidirectional link establishment

### Phase 3: AI-Powered Routing
- â³ Claude API integration for destination suggestions
- â³ Automatic metadata enrichment
- â³ Context-aware routing rules

### Phase 4: Continuous Integration
- â³ Git hooks integration
- â³ CI/CD pipeline integration
- â³ Automated symlink health monitoring
- â³ Slack/notification integration for failures

---

## Acceptance Criteria

### Operational
- [ ] Running router after Claude session surfaces all new docs
- [ ] Confirmed moves place files in correct vault directories
- [ ] YAML frontmatter populated automatically with all required fields
- [ ] EPIC and Sprint indexes include new artifacts automatically
- [ ] Fresh clone + setup script recreates all symlinks correctly

### Quality
- [ ] No documentation lost during routing
- [ ] No broken symlinks after vault structure changes
- [ ] All artifacts have complete metadata
- [ ] Bidirectional links navigable in Obsidian

### Performance
- [ ] Router completes in < 30 seconds
- [ ] Symlink validation completes in < 5 seconds
- [ ] No impact on Claude Code session performance

---

## Related Documentation

### VaultGuide
- **[[../README.md|VaultGuide README]]** - Overall vault system design
- **[[../VAULT_ARCHITECTURE.md|Vault Architecture]]** - Vault structure and conventions
- **[[../Design/DOC_ROUTER_DESIGN.md|Doc Router Design]]** - Detailed design for automation

### UPMS
- **[[../../../UPMS_Vault/Templates/|UPMS Templates]]** - Template structures for metadata
- **[[../../../UPMS_Vault/Methodology/UPMS_Methodology_Blueprint.md|UPMS Methodology]]** - Overall framework

---

## Future Enhancements

### Post-MVP Features
- Real-time monitoring dashboard (web UI)
- Cross-vault routing (for multi-product scenarios)
- AI-powered duplicate detection
- Automatic README generation for new directories
- Version control for routing rules
- Rollback capability for incorrect routes

### Integration Opportunities
- Obsidian plugin for vault health
- VS Code extension for symlink navigation
- GitHub Actions for automated validation
- Slack bot for routing approvals

---

## Open Questions

1. Should routing ever happen automatically (no prompt) for well-known patterns?
   - **Recommendation**: Start with interactive, move to automatic for trusted patterns

2. How do we surface routing failures or skipped files?
   - **Recommendation**: Log file + optional Slack notification

3. What is the governance process for evolving `doc_routing.yml`?
   - **Recommendation**: Product Owner approval required for routing rule changes

4. How do we handle routing conflicts (same file matches multiple patterns)?
   - **Recommendation**: Most specific pattern wins, fallback to interactive prompt

---

**Status**: ðŸ“‹ Planned
**Next Steps**: Implement STORY-001 (Doc Router)
**Owner**: DevOps Team
**Last Updated**: 2025-11-12
